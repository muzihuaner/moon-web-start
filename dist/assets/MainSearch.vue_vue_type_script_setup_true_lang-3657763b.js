import{ds as q,aM as de,bb as pe,e as d,N as ve,bi as he,aC as ge,h as _,A as j,C as me,d as we,u as ye,cc as ke,o as b,c as $,bY as A,bR as W,b as p,$ as F,bl as P,b2 as V,bQ as _e,aX as be,a7 as C,g as H,a8 as $e,dt as xe,n as Se,t as M,cj as Ce,ab as E}from"./index-409d7e60.js";import{u as Ie}from"./icon_style-1296f262.js";function R(t){return Object.keys(t).map(o=>`${encodeURIComponent(o)}=${encodeURIComponent(t[o])}`).join("&")}function qe(t){return`https://www.baidu.com/s?wd=${encodeURIComponent(t)}`}function Re(t,n){const o=R({prod:"wise",wd:t});q(`https://www.baidu.com/sugrec?${o}`).then(e=>e.json()).then(e=>{n({eng:"baidu",wd:e.q,list:e.g?e.g.map(r=>r.q):[]})}).catch(e=>console.error(e))}const Ae={target:qe,complete:Re};function Ee(t){return`https://www.google.com/search?q=${encodeURIComponent(t)}`}function Oe(t,n){const o=R({client:"psy-ab",hl:"zh-CN",q:t});q(`https://suggestqueries.google.com/complete/search?${o}`).then(e=>e.json()).then(e=>{n({eng:"google",wd:e[0],list:e[1].map(r=>r[0])})}).catch(e=>console.error(e))}const Le={target:Ee,complete:Oe};function je(t){return`https://www.bing.com/search?mkt=zh-cn&q=${encodeURIComponent(t)}`}function De(t,n){const o=R({type:"cb",q:t});q(`https://api.bing.com/qsonhs.aspx?${o}`,{jsonpCallback:"cb"}).then(e=>e.json()).then(e=>{const r=e.AS.Results;let a;r?a=r.map(f=>f.Suggests).reduce((f,c)=>f.concat(c),[]).sort((f,c)=>f.Sk>c.Sk?1:-1).map(f=>f.Txt):a=[],n({eng:"bing",wd:e.AS.Query,list:a})}).catch(e=>console.error(e))}const Me={target:je,complete:De};function Ne(t){return`https://zh.wikipedia.org/w/index.php?search=${encodeURIComponent(t)}`}function ze(t,n){const o=R({action:"opensearch",format:"json",formatversion:2,limit:10,search:t});q(`https://zh.wikipedia.org/w/api.php?${o}`).then(e=>e.json()).then(e=>{n({eng:"wikipedia",wd:e[0],list:e[1]})}).catch(e=>console.error(e))}const Be={target:Ne,complete:ze};function Ue(t){return`https://www.sogou.com/web?query=${encodeURIComponent(t)}`}function Te(t,n){const o=`https://wap.sogou.com/web/sugg/${encodeURIComponent(t)}`,e=R({vr:1,s:1,source:"wapsearch",encrypt:0,cb:"sug"});window.sug=r=>{n({eng:"sogou",wd:r.q,list:r.s?r.s.map(a=>a.q):[]})},q(`${o}?${e}`,{jsonpCallback:"sug"}).catch(r=>r)}const Ke={target:Ue,complete:Te},J={Baidu:Ae,Google:Le,Bing:Me,Wikipedia:Be,Sogou:Ke};function We(t,n){return J[t].target(n)}function Fe(t,n,o){return J[t].complete(n,o)}const Pe={target:We,complete:Fe};function Z(t){return de()?(pe(t),!0):!1}function L(t){return typeof t=="function"?t():d(t)}const ee=typeof window<"u",z=()=>{},N=Ve();function Ve(){var t;return ee&&((t=window==null?void 0:window.navigator)==null?void 0:t.userAgent)&&/iP(ad|hone|od)/.test(window.navigator.userAgent)}const Y={mounted:"mounted",updated:"updated",unmounted:"unmounted"};function He(...t){if(t.length!==1)return ve(...t);const n=t[0];return typeof n=="function"?he(ge(()=>({get:n,set:z}))):_(n)}function I(t){var n;const o=L(t);return(n=o==null?void 0:o.$el)!=null?n:o}const te=ee?window:void 0;function O(...t){let n,o,e,r;if(typeof t[0]=="string"||Array.isArray(t[0])?([o,e,r]=t,n=te):[n,o,e,r]=t,!n)return z;Array.isArray(o)||(o=[o]),Array.isArray(e)||(e=[e]);const a=[],f=()=>{a.forEach(m=>m()),a.length=0},c=(m,x,u,i)=>(m.addEventListener(x,u,i),()=>m.removeEventListener(x,u,i)),g=j(()=>[I(n),L(r)],([m,x])=>{f(),m&&a.push(...o.flatMap(u=>e.map(i=>c(m,u,i,x))))},{immediate:!0,flush:"post"}),y=()=>{g(),f()};return Z(y),y}let G=!1;function Q(t,n,o={}){const{window:e=te,ignore:r=[],capture:a=!0,detectIframe:f=!1}=o;if(!e)return;N&&!G&&(G=!0,Array.from(e.document.body.children).forEach(u=>u.addEventListener("click",z)));let c=!0;const g=u=>r.some(i=>{if(typeof i=="string")return Array.from(e.document.querySelectorAll(i)).some(l=>l===u.target||u.composedPath().includes(l));{const l=I(i);return l&&(u.target===l||u.composedPath().includes(l))}}),m=[O(e,"click",u=>{const i=I(t);if(!(!i||i===u.target||u.composedPath().includes(i))){if(u.detail===0&&(c=!g(u)),!c){c=!0;return}n(u)}},{passive:!0,capture:a}),O(e,"pointerdown",u=>{const i=I(t);i&&(c=!u.composedPath().includes(i)&&!g(u))},{passive:!0}),f&&O(e,"blur",u=>{var i;const l=I(t);((i=e.document.activeElement)==null?void 0:i.tagName)==="IFRAME"&&!(l!=null&&l.contains(e.document.activeElement))&&n(u)})].filter(Boolean);return()=>m.forEach(u=>u())}const X={[Y.mounted](t,n){const o=!n.modifiers.bubble;if(typeof n.value=="function")t.__onClickOutside_stop=Q(t,n.value,{capture:o});else{const[e,r]=n.value;t.__onClickOutside_stop=Q(t,e,Object.assign({capture:o},r))}},[Y.unmounted](t){t.__onClickOutside_stop()}};function ne(t){const n=window.getComputedStyle(t);if(n.overflowX==="scroll"||n.overflowY==="scroll"||n.overflowX==="auto"&&t.clientHeight<t.scrollHeight||n.overflowY==="auto"&&t.clientWidth<t.scrollWidth)return!0;{const o=t.parentNode;return!o||o.tagName==="BODY"?!1:ne(o)}}function Ye(t){const n=t||window.event,o=n.target;return ne(o)?!1:n.touches.length>1?!0:(n.preventDefault&&n.preventDefault(),!1)}function Ge(t,n=!1){const o=_(n);let e=null,r;j(He(t),c=>{if(c){const g=c;r=g.style.overflow,o.value&&(g.style.overflow="hidden")}},{immediate:!0});const a=()=>{const c=L(t);!c||o.value||(N&&(e=O(c,"touchmove",g=>{Ye(g)},{passive:!1})),c.style.overflow="hidden",o.value=!0)},f=()=>{const c=L(t);!c||!o.value||(N&&(e==null||e()),c.style.overflow=r,o.value=!1)};return Z(f),me({get(){return o.value},set(c){c?a():f()}})}function Qe(){let t=!1;const n=_(!1);return(o,e)=>{if(n.value=e.value,t)return;t=!0;const r=Ge(o,e.value);j(n,a=>r.value=a)}}Qe();const Xe={dark:"bg-$bg-c",w:"full sm:450!",bg:"gray-200",relative:"","mx-auto":"",flex:"","h-44":""},Je={bg:"$main-bg-c",border:"2 t-0","z-9":"","py-6":"","l-0":"","t-100p":""},Ze=["onMouseover","onClick","onTouchstart","onTouchend"],et={"flex-left":"","gap-x-8":"",style:{margin:"0.75rem","margin-left":"2rem"}},tt={relative:"","flex-center":"","shrink-0":"","w-44":""},nt=["src"],ot={bg:"$main-bg-c",border:"2 t-0",absolute:"","z-9":"","l-0":"","t-100p":"","w-200":""},st=["onClick"],rt={"flex-center":"","gap-x-8":"",text:"15 $text-c-1"},ct=["src"],ut={"ml-4":"","font-300":""},lt={key:0,"i-carbon:checkmark":"","text-18":""},it={flex:"","items-center":"",w:"full"},at=["onKeydown"],ft=p("span",{"i-carbon:search":"","inline-block":"","text-16":""},null,-1),dt=[ft],ht=we({__name:"MainSearch",setup(t){const n=ye(),o=ke.children,e=_(""),r=_(0),a=_();function f(){r.value=o.findIndex(s=>s.key===n.settings.search)||0}j(()=>n.settings.search,()=>{f()},{immediate:!0});function c(){var h;if(!e.value.trim())return;const s=o[r.value];window.open(`${s.value.url}?${s.value.wd}=${e.value}`),D(),(h=a.value)==null||h.blur()}function g(s){return s.favicon||$e(s.url)}const y=_(!1);function m(s){r.value=s,x()}function x(){y.value=!y.value}function u(s){s.key==="#"&&!e.value.length&&(y.value=!0);const h=(e.value+s.key).match(/^#[a-z]+/);if(h){const k=h[0].replace("#",""),w=o.findIndex(S=>S.value.s===k);if(w===-1)return;s.preventDefault(),m(w),e.value="",y.value=!1}e.value==="#"&&s.key==="Backspace"&&(y.value=!1)}const i=_(!1),l=_([]),v=_(0),oe=xe(()=>{const s=o[r.value];Pe.complete(s.key,e.value,h=>{i.value=!0,e.value.trim().length!==0&&(l.value.splice(0,l.value.length||0),l.value.push(e.value,...h.list))})},100);function se(){var s;e.value="",(s=a.value)==null||s.focus()}function B(s){if(e.value.indexOf("#")!==0){if(!e.value.trim()){D();return}v.value=0,oe()}}function re(s){e.value=l.value[s],c()}function D(){i.value=!1,l.value.splice(0,l.value.length||0),v.value=0,l.value.push(e.value)}function U(s){s.preventDefault(),v.value=(v.value+1)%l.value.length||0,e.value=l.value[v.value]}function T(s){s.preventDefault(),v.value=(v.value-1+l.value.length)%l.value.length||0,e.value=l.value[v.value]}function ce(s){s.target!==a.value&&D()}function ue(s){v.value=s}function le(){v.value=0}function ie(s){B(new Event("input"))}function ae(s){v.value=s}function fe(s){v.value=0}const{iconStyle:K}=Ie();return(s,h)=>(b(),$("div",Xe,[A((b(),$("div",{absolute:"","z-9":"","w-full":"","h-10em":"","t-100p":"",onMouseleave:h[0]||(h[0]=k=>le())},[p("div",Je,[(b(!0),$(F,null,P(d(l).slice(1),(k,w)=>(b(),$("div",{key:w+1,"text-15":"","p-5":"",class:Se(["cursor-pointer",{"bg-$site-hover-c":w+1===d(v)}]),onMouseover:S=>ue(w+1),onClick:S=>re(w+1),onTouchstart:S=>ae(w+1),onTouchend:S=>fe()},[p("div",et,[p("div",null,M(k),1)])],42,Ze))),128))])],32)),[[W,d(i)&&d(l).length>1],[d(X),ce]]),A((b(),$("div",tt,[p("div",{hover:"op-100","h-full":"","w-full":"","flex-center":"","cursor-pointer":"",op:"80","transition-300":"",onClick:x},[p("img",{src:g(d(o)[d(r)].value),style:V(d(K)),"h-32":"","w-32":""},null,12,nt)]),A(p("div",ot,[(b(!0),$(F,null,P(d(o),(k,w)=>(b(),$("div",{key:w,hover:"bg-$site-hover-c",flex:"","cursor-pointer":"","items-center":"","justify-between":"","px-12":"","py-7":"",onClick:S=>m(w)},[p("div",rt,[p("img",{src:g(k.value),style:V(d(K)),circle:"","h-20":"","w-20":""},null,12,ct),p("div",null,M(d(Ce)(k.name)),1),p("div",ut,M(`#${k.value.s}`),1)]),d(r)===w?(b(),$("div",lt)):H("",!0)],8,st))),128))],512),[[W,d(y)]])])),[[d(X),()=>y.value=!1]]),p("div",it,[A(p("input",{ref_key:"searchInputRef",ref:a,"onUpdate:modelValue":h[1]||(h[1]=k=>be(e)?e.value=k:null),text:"15 $text-c-1","h-full":"","w-full":"","bg-inherit":"","op-80":"",onKeydown:[C(c,["enter"]),u,C(E(U,["exact"]),["down"]),C(E(T,["exact"]),["up"]),C(E(U,["ctrl","exact"]),["n"]),C(E(T,["ctrl","exact"]),["p"])],onInput:B,onFocus:ie},null,40,at),[[_e,d(e)]]),d(e).length>0?(b(),$("div",{key:0,hover:"op-80","i-carbon:close":"","mr-8":"","cursor-pointer":"","text-20":"","op-40":"",transition:"","duration-300":"",onClick:se})):H("",!0)]),p("button",{"flex-center":"","shrink-0":"","gap-x-4":"","px-16":"",btn:"",onClick:c},dt)]))}});export{ht as _};
